{"slug":"2019-01-23-generating-reason-react-components-with-functors","filename":"2019-01-23-generating-reason-react-components-with-functors","title":"Generating ReasonReact components with functors","date":"Wed, 23 Jan 2019 00:00:00 GMT","draft":false,"meta":{"date":"2019-01-23T00:00:00.000Z","title":"Generating ReasonReact components with functors"},"body":"<p>In JavaScript, React components can either be function or classes. This makes it easy to create functions that return components (factories if you will).</p>\n<p>With ReasonReact though, if you want to use them with JSX, components need to be modules containing a <code>make</code> function, which is a much more static construct.</p>\n<p>Fortunately, Reason (through OCaml) has a great feature which is called functors. Think of it as a <strong>module function</strong>: it <strong>takes a module as parameter and returns a module</strong>.</p>\n<h2>The syntax</h2>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-keyword\">module</span> <span class=\"hljs-module-identifier\">Make</span> = (<span class=\"hljs-module-identifier\">Param</span>: <span class=\"hljs-module-identifier\">ParamType</span>) =&gt; {\n  <span class=\"hljs-comment\">/* contents of the module to return */</span>\n};\n</code></pre>\n<p>Let's define a <code>ParamType</code> first:</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-keyword\">module</span> <span class=\"hljs-keyword\">type</span> <span class=\"hljs-module-identifier\">ParamType</span> = {\n  <span class=\"hljs-keyword\">type</span> t;\n  <span class=\"hljs-keyword\">let</span> name: string;\n  <span class=\"hljs-keyword\">let</span> render: t =&gt; <span class=\"hljs-module-identifier\">React</span>.reactElement;\n};\n</code></pre>\n<p>Now, let's create our functor. The following example is very short and now really useful, its goal is simply to show the syntax. Where functors shine is with more complicated components, where you just want to write a simple configuration to generate a component (e.g. big virtualised, paginated lists, sortables etc.)</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-keyword\">module</span> <span class=\"hljs-module-identifier\">Make</span> = (<span class=\"hljs-module-identifier\">Param</span>: <span class=\"hljs-module-identifier\">ParamType</span>) =&gt; {\n  <span class=\"hljs-keyword\">type</span> state = {\n    value: <span class=\"hljs-module-identifier\">Param</span>.t,\n  };\n  <span class=\"hljs-keyword\">let</span> component = <span class=\"hljs-module-identifier\">React</span>.reducerComponent(<span class=\"hljs-string\">&quot;Demo&quot;</span> <span class=\"hljs-operator\">++</span> <span class=\"hljs-module-identifier\">Param</span>.name);\n  <span class=\"hljs-keyword\">let</span> make = (~value: <span class=\"hljs-module-identifier\">Param</span>.t, _) =&gt; {\n    <span class=\"hljs-operator\">...</span>component,\n    initialState: () =&gt; {value: value},\n    reducer: ((), _state) =&gt; <span class=\"hljs-module-identifier\">React</span>.<span class=\"hljs-constructor\">NoUpdate</span>,\n    render: ({state}) =&gt;\n      &lt;div style={<span class=\"hljs-module-identifier\">ReactDOMRe</span>.<span class=\"hljs-module-identifier\">Style</span>.make(~fontSize=<span class=\"hljs-string\">&quot;32px&quot;</span>, ())}&gt;\n        <span class=\"hljs-comment\">/* some markup */</span>\n         {<span class=\"hljs-module-identifier\">Param</span>.render(state.value)} &lt;/div&gt;,\n  };\n};\n</code></pre>\n<p>Now, in order to create a component, we just have to create a module with <code>Make</code>:</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-keyword\">module</span> <span class=\"hljs-module-identifier\">IntValue</span> =\n  <span class=\"hljs-module-identifier\">Make</span>({\n    <span class=\"hljs-keyword\">type</span> t = int;\n    <span class=\"hljs-keyword\">let</span> name = <span class=\"hljs-string\">&quot;Int&quot;</span>;\n    <span class=\"hljs-keyword\">let</span> render = x =&gt; x<span class=\"hljs-operator\">-&gt;</span>string_of_int<span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">React</span>.string;\n  });\n\n<span class=\"hljs-module-identifier\">ReactDOMRe</span>.renderToElementWithId(&lt;<span class=\"hljs-module-identifier\">IntValue</span> value=<span class=\"hljs-number\">2</span> /&gt;, <span class=\"hljs-string\">&quot;preview&quot;</span>);\n</code></pre>\n<p><a href=\"https://reasonml.github.io/en/try?rrjsx=true&amp;reason=LYewJgrgNgpgBAFwJ4Ad4AUCGAnTwAqq8AvHAN4BQciRiA3FXLAnAHZ4wBccAzgtgEtWAcwbVmcbDFZgY2bi2IA+OACUYmHiFbrMAYwQA6KfoQBRWMGkIGAXwYVQkWHACymANYk4ACiy5gbn88QjQASjhlckZkNF4ETARvMgA3TCgILjhg4EMEe0YJPRBgFG1rSLUNLR0NA2MYSD05AGESstZrHwAiABEYUG64AGph7Jw8Q3YrMLEmGBZgT28fAD80jKycvIAaOAB9CKjKampDc+LS8tYEHcZqIQEEAXSAZQSk7h8jlVT0zO4G0ytjup0kjQgzXkvm+e32fESMB+VU02l09QAciAAKooMCI0GnKQyORfMgIpK2H73U4AHjAAhS8SQsGIZHRCF6AHlXOpDO8WTBDEsvGsAGbaBCvAQALxgxG6AGYAEwoAAe3T23zCtiUNLBAHoAFS8ErwJbYDwQFBwI0G-VgsjbYmybA+ClCoFI2xwWkGhkpJSEgoFJzQeAASRuADV-iRGO5RSdTrF4Io4EIbDSJNNvN0owhunNxAtwSTsJU1ZEVGqALRKPiCET7EBi-aZ+u6GocwyNoSiRhUhwc7m8oUuuT4EAWAbWADqTwAFhGwD5aQXY5s4F7iMq4Aag3BuigpCkBDAAO7dWYUIA\">Test it on the ReasonML playground</a></p>\n"}